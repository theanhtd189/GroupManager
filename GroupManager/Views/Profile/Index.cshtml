@using GroupManager.Models
@{

    Layout = "~/Views/Shared/_Header.cshtml";
    User u = ViewBag.CurrentUser;
    string g0 = "true";
    string g1 = "false";
    if (u.Gender)
    {
        g1 = "true";
        g0 = "false";
    }
    string u_date = u.Date.Value.ToString("yyyy-MM-dd");
}



    <div class="right" style="background-color: #fefefed9;">
        <h3 class="heading">Thông tin cá nhân</h3>
        <div class="profile_">
            <div class="flex_ycenter">
                <div class="img_avt" style="background-image: url('../../Resourses/Images/avt.png');"></div>
                <label class="btn upfile" for="file_avt">Tải ảnh đại diện</label>
                <input type="file" name="file_avt" id="file_avt">
            </div>
            <div class="info_">
                <form action="@Url.Action("Edit","Profile")" method="post" id="post_form" class="child_flex-c" onsubmit="return check(event)">
                    <input type="hidden" name="user_id" value="@u.ID" />
                    <div>
                        <label for="">USERNAME</label>
                        <input type="text" required id="usernam" value="@u.Username" name="username" readonly>
                    </div>
                    <div>
                        <label for="">Họ và tên</label>
                        <input type="text" required id="fullname" value="@u.FullName" name="fullname">
                    </div>
                    <div>
                        <label for="">Email</label>
                        <input type="email" required id="email" value="@u.Email" name="email">
                    </div>

                    <div>
                        <label for="">Ngày sinh</label>
                        <input type="date" value="@u_date" required id="ns" name="date">
                    </div>
                    <div>
                        <label for="">Giới tính</label>
                        <div>
                            <div class="i_radio">
                                <label for="">Nữ</label>
                                <input type="radio" name="gender" value="0" checked="@g0">
                            </div>
                            <div class="i_radio">
                                <label for="">Nam</label>
                                <input type="radio" name="gender" value="1" checked="@g1">
                            </div>
                        </div>
                    </div>
                    <div class="flowroot">
                        <input type="checkbox" id="changepass">
                        <label for="">Đổi mật khẩu</label>
                    </div>
                    <div>
                        <label for="">Mật khẩu mới</label>
                        <input type="password" id="pass" name="password">
                    </div>
                    <div>
                        <label for="">Nhập lại mật khẩu mới</label>
                        <input type="password" id="pass2">
                    </div>
                    <div class="_btn">
                        <button class="btn" type="submit">Xác nhận</button>
                        <button class="btn" type="submit"><a href="@Request.UrlReferrer">Hủy</a></button>
                    </div>
                </form>
            </div>

        </div>

    </div>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<script>
function check(e){
    var changepass = $("#changepass");
    var p = $("#pass").val();
    var p2 = $("#pass2").val();
    var ten = $("#fullname").val();
    var email = $("#email").val();
    var date = $("#ns").val();
    var gt = $("input[name='gt']:checked").val();
    if(changepass.prop("checked")==true){
        if(p.length<=0 || p2.length<=0){
            alert("Vui lòng nhập mật khẩu hợp lệ");
            return false;
        }
        else
        if(p!=p2){
            alert("Mật khẩu không khớp");
            return false;
        }
        else
        {
            e.preventDefault();
            var form = $("#post_form");
            var actionUrl = form.attr('action');

            $.ajax({
                type: "POST",
                url: actionUrl,
                data: form.serialize(),
                success: function (data) {
                    if (data == "True") {
                        alert("Thành công!");
                    }
                    else
                        alert("Lỗi ! Vui lòng thử lại sau");
                },
                error: function () {
                    alert("Lỗi !");
                }
            });
        }
    }else
    {
        e.preventDefault();
        var form = $("#post_form");
        var actionUrl = form.attr('action');

        $.ajax({
            type: "POST",
            url: actionUrl,
            data: form.serialize(),
            success: function (data) {
                if (data == "True") {
                    alert("Thành công!");
                }
                else
                    alert("Lỗi ! Vui lòng thử lại sau");
            },
            error: function () {
                alert("Lỗi !");
            }
        });
    }
}
</script>
